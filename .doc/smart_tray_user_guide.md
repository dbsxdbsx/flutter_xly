# 智能托盘隐藏功能 - 用户指南

## 📖 概述

智能托盘隐藏是XLY包中的一个高级功能，它能够根据当前窗口状态智能地决定托盘隐藏的行为方式。这个功能让托盘隐藏与智能停靠功能完美协作，为用户提供更加流畅和直观的体验。

## 🎯 功能特点

### ✨ 智能模式切换
- **自动检测**：系统自动检测当前是否处于智能停靠状态
- **智能决策**：根据状态选择最合适的隐藏方式
- **无缝协作**：托盘隐藏与智能停靠功能完美配合

### 🔄 两种工作模式

#### 1. 普通托盘模式
**触发条件**：窗口未处于智能停靠状态时

**行为表现**：
- ✅ 隐藏窗口UI（窗口完全消失）
- ✅ 隐藏任务栏图标
- ✅ 只能通过托盘图标恢复窗口

**使用场景**：
- 正常使用应用时临时隐藏
- 需要完全清理桌面空间
- 传统的托盘隐藏需求

#### 2. 智能停靠托盘模式
**触发条件**：窗口处于智能停靠状态时（边缘或角落停靠）

**行为表现**：
- ✅ 保持窗口UI（智能停靠功能继续工作）
- ✅ 隐藏任务栏图标
- ✅ 鼠标仍可激活窗口显示/隐藏
- ✅ 防止意外激活系统任务栏
- ✅ 可通过托盘图标或鼠标交互恢复

**使用场景**：
- 需要快速访问应用但不想占用任务栏
- 保持智能停靠的便利性
- 后台监控类应用

## 🎮 用户体验说明

### 普通模式体验
```
用户操作：点击"隐藏到托盘"
系统行为：窗口消失 + 任务栏图标消失
恢复方式：点击托盘图标
```

### 智能停靠模式体验
```
用户操作：在智能停靠状态下点击"隐藏到托盘"
系统行为：任务栏图标消失，但窗口保持智能停靠功能
交互方式：鼠标移动到屏幕边缘仍可激活窗口
恢复方式：点击托盘图标 或 继续使用智能停靠交互
```

### 托盘左击行为（智能停靠隐藏下）
```
用户操作：在“智能停靠隐藏”状态下，左键点击托盘图标
系统行为：窗口在原停靠的边/角位置“像悬停一样”弹出（不激活、不聚焦）
特别说明：
- 这次弹出不会立即因鼠标不在窗口上而收回；
- 当用户第一次把鼠标移入窗口后，再移出时，会按平常规则自动收回；
- 非智能停靠状态下，左击托盘会正常“显示并聚焦”主窗口。
```

## 🚀 使用方法

### 基础使用
```dart
final tray = MyTray.to;

// 智能隐藏到托盘（自动选择模式）
tray.hide();

// 从托盘恢复
tray.pop();
```

### 完整示例
```dart
// 1. 配置托盘
await MyApp.initialize(
  tray: MyTray(
    tooltip: "我的应用",
    menuItems: [
      MyTrayMenuItem(
        label: '恢复显示',
        onTap: () => MyTray.to.pop(),
      ),
      MyTrayMenuItem.separator(),
      MyTrayMenuItem(
        label: '退出应用',
        onTap: () => exit(0),
      ),
    ],
  ),
);

// 2. 在应用中使用
class MyController extends GetxController {
  void hideToTray() {
    final tray = MyTray.to;
    tray.hide(); // 智能选择隐藏模式

    // 可选：显示通知
    MyNotify.to.show("已隐藏到托盘", "点击托盘图标可恢复窗口");
  }
}
```

## 💡 使用技巧

### 1. 智能停靠 + 托盘的最佳实践
- **先启用智能停靠**：将窗口拖拽到屏幕边缘
- **再隐藏到托盘**：享受双重便利性
- **灵活切换**：可随时通过托盘图标完全恢复

### 2. 不同场景的选择
- **临时隐藏**：直接使用托盘隐藏（普通模式）
- **后台运行**：先智能停靠，再托盘隐藏（智能模式）
- **演示模式**：智能停靠模式，保持快速访问能力

### 3. 状态识别
- **查看日志**：开发模式下可通过控制台日志了解当前模式
- **观察行为**：鼠标移动到边缘是否能激活窗口
- **任务栏状态**：图标消失但功能保持

## ⚠️ 注意事项

### 系统要求
- **Windows平台**：完整功能支持
- **其他平台**：基础托盘功能，无高级任务栏控制

### 使用限制
- 智能停靠功能需要先启用才能触发智能模式
- 任务栏激活控制仅在Windows平台有效
- 某些系统设置可能影响功能表现

### 故障排除
1. **智能模式未触发**：
   - 确认智能停靠功能已启用
   - 检查窗口是否正确停靠到边缘

2. **任务栏仍然激活**：
   - 检查是否为Windows平台
   - 查看控制台日志确认功能状态

3. **鼠标交互失效**：
   - 确认处于智能停靠托盘模式
   - 检查智能停靠监听是否正常

## 🔗 相关文档

- [智能托盘技术文档](.doc/smart_tray_technical.md) - 开发者技术细节
- [智能停靠功能文档](lib/src/smart_dock/README.md) - 智能停靠使用指南
- [托盘设计文档](.doc/my_tray_design.md) - 托盘功能设计理念

## 📞 支持

如果在使用过程中遇到问题，请：
1. 查看控制台日志获取详细信息
2. 参考技术文档了解实现细节
3. 在项目仓库中提交Issue

---

*最后更新：2025-08-01*
